@{ string nom = (string)ViewBag.Nombre;}

<div class="box box-warning">
    <div class="box-header with-border">
        <h3 class="box-title"><i class="fa fa-gear"></i> Agregar Propuesta para el Cliente : @nom </h3>
    </div>
</div>

<form id="mant-form" action="@Url.Action("AgregarPropuestaCliente", "CRM")" method="post">
    <div class="panel">
        <br />
        <div class="box-header with-border">
            <h3 class="box-title">Agregar Propuesta</h3>
        </div>
        <div class="row col-sm-12">
            <div class="col-sm-4">
                <div class="input-group">
                    @Html.DropDownList("documento", ((SelectList)ViewBag.categorias), "Select...", new { @id = "documento1", @class = "selectCat form-control" })
                </div>
            </div>
            <div class="col-sm-4">
                <input type="file" id="files1" name="files" class="uploadfile" />
            </div>
        </div>
    </div>
    <br />
    <br />
    <div class="box-header with-border">
        <h3 class="box-title">Seleccione los servicios de la propuesta </h3>
    </div>
    <div id="example">
    </div>
    <div class="box-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" aria-label="Close">Cerrar</button>
        <button type="button" class="btn btn-warning pull-right" action="save">Guardar</button>
    </div>
</form>

<script>
    var id_cliente = @ViewBag.ID_CLiente;
    
    function CargaListServices() {
        $.ajax({
            async: true,
            type: 'POST',
            url: "@Url.Action("ServiciosLista", "PropuestaServicio")",
            data: {id : id_cliente},
        success: function (result)
        {
            var aux = "";
            
            var html_ = '<div class="anchor">' +
                            '<ul>';
            debugger;
            $.each(result.data, function(index, item){
                if(aux == ""){
                    html_ = html_ + '<li>'+
                                        '<label><input type="checkbox" data-id='+ item.ID_servicio +' data-name='+ item.ID_servicio +' />'+ item.Nombre+'</label>'+
                                        '<ul>';                     
                }
                if(item.ID_Padre != null){
                            html_ = html_ + '<li>'+
                                                '<label><input type="checkbox" data-id='+ item.ID_servicio +' data-name='+item.ID_servicio+' value ='+item.ID_servicio+'/> '+ item.Nombre +'</label>'+
                                            '</li>';
                }
                if(item.ID_Padre == null && (aux != "" || aux > 100)){
                    html_ = html_ +     '</ul>'+
                                        '</li>'+
                                        '<li>'+
                                            '<label><input type="checkbox" data-id='+ item.ID_servicio +' data-name='+ item.ID_servicio +' />'+ item.Nombre+'</label>'+
                                        '<ul>';
                }
                aux = item.ID_Padre;
            });
            html_ = html_ + '</ul>'+
                        '</div>';
            debugger;
            $('#example').append(html_);
            $('.anchor').deepcheckbox({
                readableListTarget: '.selected-readable',
                onChange: function(items, except) {
                    $('.selected').html('[' + items.join(', ') + ']');
                    $('.excepted').html('[' + except.join(', ') + ']');
                }
            });
        }
    });}

    var $upload = $(".uploadfile").fileinput({
        showPreview: false,
        showCancel: true,
        showUpload: false,
        browseClass: 'btn btn-warning',
        browseLabel: 'Select Document',
        browseIcon: "<span class='glyphicon glyphicon-open-file' aria-hidden='true'></span>",
        removeClass: "btn btn-danger",
        removeLabel: "Delete",
        removeIcon: "<i class=\"glyphicon glyphicon-trash\"></i>",
        showCancel: true//,
        //maxFileSize: 2500

    }).on('fileerror', function (e, params) {
        iziToast.error({
            title: 'Error',
            message: "<i class='fa fa-clock-o'></i> <i>" + e.handleObj.handler.arguments[2] + "...</i>",
            position: 'topRight',
            transitionIn: 'fadeInDown'
        });
    });

    
    $(document).ready(function(){
        debugger;
        setFormulario("mant-form");
        CargaListServices();
        

        //$(".anchor").deepcheckbox();
        //$('.anchor').deepcheckbox({
        //    readableListTarget: '.selected-readable',
        //    onChange: function(items, except) {
        //        $('.selected').html('[' + items.join(', ') + ']');
        //        $('.excepted').html('[' + except.join(', ') + ']');
        //    }
        //});
    });
</script>