
@{
    ViewBag.Title = "Index";
}
<style>
    [class^='select2'] {
  border-radius: 0px !important;
}
</style>
<div class="box box-warning">
    <div class="box-header with-border">
        <h3 class="box-title"><i class="fa fa-users"></i> Asignaciones Clientes / Usuarios</h3>
    </div>
</div>

<br />

<div class="row">
    <div class="col-md-6">
        <div class="box">
            <div class="box-header with-border">
                <label class="col-md-6">Asignados por empresa</label>
                <div class="col-md-6">
                    @Html.DropDownList("empresas", new SelectList(ViewBag.listadoClientes, "id", "Nom"), "-- Seleccione --", new { @class = "form-control", id = "empresas" })
                </div>

            </div>

            <div class="box-body">
                <table class="table table-striped table-bordered" style="width:100%;" id="tblEmpresas">
                    <thead>
                        <tr>
                            <th>Nombre Usuario</th>
                            <th>Cargo</th>
                            <th>Unidad</th>
                        </tr>
                    </thead>
                </table>
            </div>

        </div>
    </div>

    <div class="col-md-6">
        <div class="box">
            <div class="box-header with-border">
                <label class="col-md-6 control-label">Asignados por usuario</label>
                <div class="col-md-6">
                    @Html.DropDownList("usuarios", new SelectList(ViewBag.listadoUsuarios, "id", "Nom"), "-- Seleccione --", new { @class = "form-control", id = "usuarios" })
                </div>

            </div>
                <div class="box-body">
                    <table class="table table-striped table-bordered" style="width:100%;" id="tblUsuarios">
                        <thead>
                            <tr>
                                <th>Clientes asignados a :</th>
                            </tr>
                        </thead>
                    </table>
                </div>

          
        </div>
    </div>
</div>

    <script>
        $(function () {
            $('#empresas').select2();
            $('#usuarios').select2();

            $('#empresas').change(function () {
                tablaEmpresas.ajax.reload();
            });

            $('#usuarios').change(function () {
                tablaClientes.ajax.reload();
                $("#tblUsuarios").find("th")
                .html("<span>" + "Clientes Asignados a :  " + "<label style='color:red'>" +  $("#usuarios option:selected").text() + "</label>" + "</span>");
            });

            function retornaEmpresas(d) {
                return $.extend({}, d, {
                    "id": $('#empresas').val(),
                });
            }

            function retornaUsuarios(d) {
                return $.extend({}, d, {
                    "id": $('#usuarios').val(),
                });
            }

      
            var colEmpresas = [
              { "data": "nombreUsuario" },
              { "data": "nombreCargo" },
              { "data": "nombreUnidad" }
            ]

            var colUsuarios = [
              { "data": "nombreCliente" },
            ]


            function dt_Empresas(grilla, url, parametros, Columnas, callBack) {
                var tabla;
                callBack = typeof callBack !== 'undefined' ? callBack : function (ajax) { return ajax.data };
                tabla = $('#' + grilla).DataTable({

                    "ajax": {
                        "url": url,
                        "type": "POST",
                        "data": parametros,
                    },
                    "columns": Columnas,
                    //"order": [[0, "asc"]]


                });
                return tabla;
            }


            function dt_Usuarios(grilla, url, parametros, columnas) {
                var tabla;
                tabla = $('#' + grilla).DataTable({

                    "ajax": {
                        "url": url,
                        "type": "POST",
                        "data": parametros
                    },
                    "columns":columnas
                });
                return tabla;
            }

            var tablaEmpresas = dt_Empresas("tblEmpresas", "@Url.Action("dt_ClieAsignados", "ClientesAsignados")", retornaEmpresas, colEmpresas);
            var tablaClientes = dt_Usuarios("tblUsuarios", "@Url.Action("dt_empAsignadas", "ClientesAsignados")", retornaUsuarios, colUsuarios);

        });
    </script>
