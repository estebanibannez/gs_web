@using WebApplication.App_GlobalResources

@model WebApplicationMod.Usu
@{
    ViewBag.Title = "Calendar";
    Random r = new Random();
    var colores = new[] { "#56c4fb", "#1baa06", "#c186ab", "#8e091e", "#76ad00" };
    //int numColor = colores.Length;
}

<style>
    div.outer-div {
      position: absolute;
      top: 50%;
      margin-top: -350px;
      /* half of #content height*/
      left: 0;
      width: 100%;
    }

div.middle-div {
  width: 70%;
  margin-left: auto;
  margin-right: auto;
  height: 100%;
  border: 0px solid #000000;
}

</style>

@if (ViewBag.unidad != 86)
{
<section class="content">

    <div class="row">
        <div class="col-lg-4 col-xs-4">

            <div class="small-box bg-aqua">
                <div class="inner">
                    <h3>@ViewBag.clieTotal</h3>
                    <p>Clientes</p>
                </div>
                <div class="icon">
                    <i class="ion ion-bag"></i>
                </div>
            </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-4 col-xs-4">

            <div class="small-box bg-green">
                <div class="inner">
                    <h3>23</h3>
                    <p>Propuesta Clientes</p>
                </div>
                <div class="icon">
                    <i class="ion ion-stats-bars"></i>
                </div>
            </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-4 col-xs-4">

            <div class="small-box bg-yellow">
                <div class="inner">
                    <h3>125</h3>
                    <p>Usuarios</p>
                </div>
                <div class="icon">
                    <i class="ion ion-person-add"></i>
                </div>
            </div>
        </div>

    </div>

    <div class="row">
        @*<a href="@Url.Action("Correos","Correos", new {Area = "Utilidades"})" class="btn btn-warning pull-right modal-ajax-load" data-toggle="modal" data-target="#myModal" data-remote="false"> Enviar Correo</a>*@
        <!-- Columnas-->
        <div class="connectedSortable ui-sortable col-md-6">
            <!-- Colaboradores -->
            <div class="box box-warning">
                <div class="box-header ui-sortable-handle" style="cursor: move;">
                    <i class="fa fa-envelope"></i>
                    <h3 class="box-title">Colaboradores</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn bg-warning btn-sm" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn bg-warning btn-sm" data-widget="remove">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>

                </div>
                <div class="box-body">


                    <table id="dt_basicUsu" class="table table-bordered table-hover dataTable">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Nombre</th>
                                <th>Usuario</th>
                                <th>Anexo</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            @try
                            {
                                foreach (var usu in (List<WebApplicationMod.Usu>)ViewBag.lista_usu)
                                {
                                    var rutaimg = "../Img/fotos2/" + @usu.Sigla + ".jpg";
                                    <tr>
                                        <td><img src="@rutaimg" alt="@usu.Sigla" onerror="this.src='../Img/fotos2/error.jpg'" class="img-thumbnail" width="52" height="60"></td>
                                        <td>@usu.Nom</td>
                                        <td>@usu.Sigla</td>
                                        <td>@usu.Anexo</td>
                                    </tr>
                                }
                            }
                            catch (Exception e) { }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>



        <div class="connectedSortable ui-sortable col-md-6">
            <div class="box box-solid bg-teal">
                <div class="box-header ui-sortable-handle" style="cursor: move;">
                    <i class="fa fa-th"></i>
                    <h3 class="box-title">Clientes PSO</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn bg-teal btn-sm" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn bg-teal btn-sm" data-widget="remove">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="box-body">
                    <div class="pad">
                        <div id="vector-map" class="vector-map" style="width:100%; height: 400px"></div>
                    </div>
                </div>

            </div>
        </div>





        <div class="col-md-6">
            <div class="box box-danger">
                <div class="box-header with-border">
                    <h3 class="box-title">Saldos Contable Clientes</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body no-padding">
                    <div class="col-md-3">
                        @Html.DropDownList("Clientes", (SelectList)ViewBag.clientes, new { @class = "form-control" })
                    </div>
                    <table id="dt_saldos" class="table table-bordered table-hover dataTable">
                        <thead>
                            <tr>
                                <th>Codigo</th>
                                <th>Descripción</th>
                                <th>Saldo</th>
                            </tr>
                        </thead>
                        <tbody id="tbody"></tbody>
                    </table>

                </div>
                <!-- /.box-body -->
                <div class="box-footer text-center">

                </div>
                <!-- /.box-footer -->
            </div>
            <!--/.box -->
        </div>




        <div class="col-md-6">
            <div class="box box-danger">
                <div class="box-header with-border">
                    <h3 class="box-title">Clientes PSO</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                    <div class="box-body">
                        <table id="tblSaldoBanco" class="table table-striped table-bordered" style="width:100%;" id="tblClientes">
                            <thead>
                                <tr>
                                    @*<th>ID</th>*@
                                    <th>Nombre Cliente</th>
                                    <th>Saldo</th>
                                    <th>Fecha Ejecución</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body no-padding">

                </div>
                <!-- /.box-body
                <div class="box-footer text-center">
                    <a href="javascript:void(0)" class="uppercase">View All Users</a>
                </div>
                 .box-footer -->
            </div>
            <!--/.box -->
        </div>

    </div>
</section>
}
else
{
    <div class="content">
        <div class="outer-div">
            <div class="middle-div">

                <img src="~/Img/LOGO_PSO 2@4x.png" height="100%" width="100%" />
            </div>
        </div>
    </div>


    <div id="carouselExampleInterval" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
            <div class="item active" data-interval="10000">
                <img src="https://source.unsplash.com/640x480/?nature,water" class="d-block w-100" alt="...">
            </div>
            <div class="item" data-interval="2000">
                <img src="https://source.unsplash.com/640x480/?nature,water" class="d-block w-100" alt="...">
            </div>
            <div class="item">
                <img src="https://source.unsplash.com/640x480/?nature,water" class="d-block w-100" alt="...">
            </div>
        </div>
        <a class="carousel-control-prev" href="#carouselExampleInterval" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleInterval" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>
}


<style type='text/css'>
    ul.pagination {
        margin: 0px !important;
    }
</style>
<script>
        InicializaMantenedor("dt_basicUsu");
        setFormulario();
        $(document).ready(function () {
            CallSaldoCuentaBanco();
            CallSaldoCuenta();

            /*
             * VECTOR MAP
             */

            data_array = {
                "AR": 26,
                "AU": 40,
                "AT": 6,
                "BE": 3,
                "BR": 6,
                "CA": 33,
                "CL": 32,
                "CN": 10,
                "CO": 5,
                "CY": 1,
                "DK": 4,
                "EC": 2,
                "FI": 2,
                "FR": 11,
                "DE": 17,
                "GR": 1,
                "HU": 2,
                "IN": 11,
                "ID": 1,
                "IE": 8,
                "IL": 6,
                "IT": 4,
                "JP": 4,
                "KR": 3,
                "LU": 3,
                "MX": 7,
                "NL": 5,
                "NO": 3,
                "PE": 4,
                "PL": 1,
                "PT": 2,
                "RU": 2,
                "ES": 4,
                "SE": 3,
                "CH": 7,
                "TW": 1,
                "UY": 1,
                "US": 135
            };




            $('#vector-map').vectorMap({
                map: 'world_mill_en',
                backgroundColor: '#fff',
                regionStyle: {
                    initial: {
                        fill: '#c4c4c4'
                    },
                    hover: {
                        "fill-opacity": 1
                    }
                },
                series: {
                    regions: [{
                        values: data_array,

                        scale: ['#85a8b6', '#4d7686'],
                        normalizeFunction: 'polynomial'
                    }]
                },

                onRegionTipShow: function (e, el, code) {
                    el.html(el.html() + ' </br> (Clientes PSO - ' + data_array[code] + ')');
                }
            });




            $("#Clientes").change(function () {

                CallSaldoCuenta();
            });


            function CallSaldoCuenta() {
                var idCLiente = $("#Clientes").val();
                var url_ = "@Url.Action("ObtenerSaldoCuentas", "Home")" + "?ID=" + idCLiente;
                $('#dt_saldos').append('<tbody />').children('tbody').html('');
                $.getJSON(url_, function (result) {
                    var $tbody = $('#dt_saldos').append('<tbody />').children('tbody');

                    $.each(result.data, function (value, index) {
                    // add row
                    $tbody.append('<tr />').children('tr:last')
                    .append("<td>" + index.PctCod + "</td>")
                    .append("<td>" + index.PCDESC + "</td>")
                    .append("<td>" + index.Saldo + "</td>")

                    });

                });

            }



            function CallSaldoCuentaBanco() {
                //var idCLiente = $("#Clientes").val();
                var url_ = "@Url.Action("ObtenerSaldoCuentasBanco", "Home")"
                $('#dt_saldos').append('<tbody />').children('tbody').html('');
                $.getJSON(url_, function (result) {
                    var $tbody = $('#tblSaldoBanco').append('<tbody />').children('tbody');

                    $.each(result.data, function (value, index) {
                        // add row
                        $tbody.append('<tr />').children('tr:last')
                        .append("<td>" + index.nom + "</td>")
                        .append("<td>" + index.saldo + "</td>")
                        .append("<td>" + new moment(index.fecha).format('DD/MM/YYYY hh:mm') + "</td>")

                    });

                });

            }

        });



</script>